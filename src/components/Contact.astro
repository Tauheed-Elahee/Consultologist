---
---

<section id="contact">
	<div>
		<h2>Ready to Transform Your Practice?</h2>
		<p>Checkout how Consultologist AI can make consults for you.</p>
	</div>

	<div class="form-container">
		<fluent-text-area
			id="comments"
			placeholder="Enter your consultation details here..."
			rows="6"
		></fluent-text-area>

		<fluent-button appearance="accent" id="consultologist-send">
			Send to Consultologist
		</fluent-button>

		<fluent-card id="consultologist-response" class="response-card">
		</fluent-card>
	</div>
</section>

<style>
	section {
		padding: var(--spacingVerticalXXXL) var(--spacingHorizontalL);
		background: var(--colorNeutralBackground1);
		text-align: center;
	}

	h2 {
		color: var(--colorNeutralForeground1);
		margin-bottom: var(--spacingVerticalM);
	}

	section > div > p {
		color: var(--colorNeutralForeground2);
		margin-bottom: var(--spacingVerticalXXL);
	}

	.form-container {
		max-width: 800px;
		margin: 0 auto;
		display: flex;
		flex-direction: column;
		gap: var(--spacingVerticalL);
	}

	fluent-text-area {
		width: 100%;
	}

	.response-card {
		padding: var(--spacingVerticalL) var(--spacingHorizontalL);
		min-height: 100px;
		text-align: left;
	}

	.loading-message {
		text-align: center;
		padding: var(--spacingVerticalXL);
		color: var(--colorNeutralForeground2);
	}

	.error-message {
		text-align: center;
		padding: var(--spacingVerticalL);
		color: var(--colorPaletteRedForeground1);
	}
</style>

<script>
	const consultologistButton = document.getElementById('consultologist-send') as HTMLButtonElement;
	const consultationTextarea = document.getElementById('comments') as any;
	const responseContainer = document.getElementById('consultologist-response') as HTMLElement;

	if (consultologistButton && consultationTextarea && responseContainer) {
		consultologistButton.addEventListener('click', async function() {
			const prompt = consultationTextarea.value?.trim();

			if (!prompt) {
				responseContainer.innerHTML = `
					<div class="error-message">
						<p>Please enter consultation details before sending.</p>
					</div>
				`;
				return;
			}

			const originalText = consultologistButton.textContent;
			consultologistButton.textContent = 'Processing...';
			consultologistButton.disabled = true;

			responseContainer.innerHTML = `
				<div class="loading-message">
					<fluent-progress-ring></fluent-progress-ring>
					<p>Consultologist is analyzing your input and generating a consultation note...</p>
				</div>
			`;

			try {
				const response = await fetch('/api/chat', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({ prompt })
				});

				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}

				const html = await response.text();
				responseContainer.innerHTML = html;

			} catch (error) {
				console.error('Error calling Consultologist API:', error);
				responseContainer.innerHTML = `
					<div class="error-message">
						<h3>⚠️ Error</h3>
						<p>Sorry, there was an error processing your request. Please check your API key configuration and try again.</p>
					</div>
				`;
			} finally {
				consultologistButton.textContent = originalText;
				consultologistButton.disabled = false;
			}
		});
	}
</script>
